{"ast":null,"code":"const bcrypt = require('bcrypt');\n\nconst saltRounds = 10;\n\nconst jwt = require('jsonwebtoken');\n\nimport cookie from 'cookie';\nimport { secretKey } from '../../../api/secretKey';\nimport { openDB } from '../../../api/openDB';\nexport default async function SignUp(req, res) {\n  const db = await openDB(); // await db.migrate({force:true});\n\n  if (req.method === 'POST') {\n    bcrypt.hash(req.body.password, saltRounds, async function (err, hash) {\n      await db.run(`INSERT INTO People (name , email , password) VALUES(\"${req.body.name}\",\"${req.body.email}\",\"${hash}\")`);\n      const people = await db.get('SELECT id,name,email FROM People '); // result == true\n\n      if (!err && people) {\n        const token = jwt.sign({\n          sub: people.id,\n          Email: people.email\n        }, secretKey, {\n          expiresIn: '1h'\n        });\n        res.setHeader('Set-Cookie', cookie.serialize('auth', token, {\n          httpOnly: true,\n          secure: true,\n          // allow not use https on dev\n          sameSite: 'strict',\n          //same with true\n          maxAge: 3600,\n          path: '/'\n        }));\n        res.json({\n          message: \"Register succesfully !\"\n        });\n      } else {\n        res.json({\n          message: \"Oop! Something went wrong!\"\n        });\n      }\n    });\n  } else {\n    res.status(405).json({\n      message: \"We got you!!!\"\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module"}