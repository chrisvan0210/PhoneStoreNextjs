{"ast":null,"code":"import { secretKey } from '../../../api/secretKey';\n\nconst bcrypt = require('bcrypt');\n\nconst jwt = require('jsonwebtoken');\n\nimport cookie from 'cookie';\nimport { openDB } from '../../../api/openDB';\nexport default async function Login(req, res) {\n  const db = await openDB();\n\n  if (req.method === 'POST') {\n    const people = await db.get(`SELECT * FROM People WHERE email= ?`, req.body.email);\n    bcrypt.compare(req.body.password, people.password, async function (err, result) {\n      // result == true\n      console.log(\"login\");\n\n      if (!err && result) {\n        const token = jwt.sign({\n          sub: people.id,\n          Email: people.email\n        }, secretKey, {\n          expiresIn: '1h'\n        });\n        res.setHeader('Set-Cookie', cookie.serialize('auth', token, {\n          httpOnly: true,\n          secure: true,\n          // allow not use https on dev\n          sameSite: 'strict',\n          //same with true\n          maxAge: 3600,\n          path: '/'\n        }));\n        res.json({\n          message: \"Welcome back Master!\"\n        });\n      } else {\n        res.json({\n          message: \"Oop! Something went wrong!\"\n        });\n      }\n    });\n  } else {\n    res.status(405).json({\n      message: \"This page only for Post!!!\"\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module"}